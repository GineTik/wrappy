#!/bin/bash

# Fake Node.js runtime –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
echo "üü¢ Node.js v18.17.0 (–ø–∞–∫–µ—Ç node-18)"
echo "üìÅ –†–æ–±–æ—á–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è: $(pwd)"
echo "üìù –ê—Ä–≥—É–º–µ–Ω—Ç–∏: $@"

if [ "$#" -eq 0 ]; then
    echo "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: node <script.js>"
    exit 0
fi

if [ -f "$1" ]; then
    echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞: $1"
    echo "--- –ü–æ—á–∞—Ç–æ–∫ –≤–∏–≤–æ–¥—É —Å–∫—Ä–∏–ø—Ç–∞ ---"
    
    # –ü—Ä–æ—Å—Ç–∏–π "—ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä" –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó
    while IFS= read -r line; do
        if [[ $line == *"console.log"* ]]; then
            # –í–∏–¥–æ–±—É–≤–∞—î–º–æ —Ç–µ–∫—Å—Ç –º—ñ–∂ –ª–∞–ø–∫–∞–º–∏
            output=$(echo "$line" | sed -n "s/.*console\.log[^'\"]*['\"]\\([^'\"]*\\)['\"].*/\\1/p")
            if [ -n "$output" ]; then
                echo "$output"
            fi
        elif [[ $line == *"process.env.MESSAGE"* ]]; then
            echo "${MESSAGE:-–ü—Ä–∏–≤—ñ—Ç –∑ node-18!}"
        fi
    done < "$1"
    
    echo "--- –ö—ñ–Ω–µ—Ü—å –≤–∏–≤–æ–¥—É —Å–∫—Ä–∏–ø—Ç–∞ ---"
    echo "‚úÖ –°–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ"
else
    echo "‚ùå –§–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ: $1"
    exit 1
fi